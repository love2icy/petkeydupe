<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Echo Scripts Key Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Poppins', sans-serif;
      background: #000;
      color: #fff;
      height: 100vh;
      overflow: hidden;
    }
    #bg-video {
      position: fixed; top: 0; left: 0;
      width: 100vw; height: 100vh;
      object-fit: cover; z-index: -2;
    }
    .container {
      position: relative; height: 100%;
      display: flex; flex-direction: column;
      align-items: center; text-align: center;
    }
    .header {
      margin-top: 5vh;
      animation: fadeInDown 1.2s ease-out both;
    }
    h1 { font-size: 3rem; font-weight: 700; text-shadow:0 0 8px rgba(0,0,0,0.3); }
    h2 {
      font-size:1.8rem; font-weight:500;
      text-shadow:0 0 6px rgba(0,0,0,0.3);
      animation: fadeInDown 1.2s 0.3s both;
    }
    .interactive {
      margin-top: 15vh;
      display: flex; flex-direction: column;
      align-items: center; gap:1.5rem;
      width:100%;
    }
    button {
      background:transparent; border:2px solid #fff;
      color:#fff; padding:15px 40px;
      font-size:1.2rem; font-weight:600;
      border-radius:50px; cursor:pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      box-shadow:0 0 8px rgba(255,255,255,0.2),
                 0 0 15px rgba(255,255,255,0.1);
      opacity: 0; transform: translateY(20px);
    }
    button:disabled {
      border-color:#666; color:#666;
      cursor:not-allowed; background:rgba(255,255,255,0.05);
      box-shadow:none;
    }
    button:hover:not(:disabled) {
      background: rgba(255,255,255,0.1);
      transform: translateY(-2px);
      box-shadow:0 0 12px #fff, 0 0 20px #fff;
    }
    #generate-btn { animation: fadeInSlideUp 1.5s 1.5s forwards; }
    #copy-btn {
      display:none;
      animation: fadeInSlideUp 1.5s 2s forwards;
    }
    #result {
      background:rgba(255,255,255,0.15); padding:20px;
      border-radius:15px; max-width:360px;
      font-weight:500; font-size:1.1rem;
      box-shadow:0 0 10px rgba(0,0,0,0.2);
      word-break:break-word; user-select:text;
      white-space: pre-line;
      opacity: 0; transform: translateY(20px);
      animation: fadeInSlideUp 1.5s 1.5s forwards;
    }
    .footer {
      position:absolute; bottom:20px; width:100%;
      font-size:.9rem; color:#ddd; text-align:center;
      animation: fadeInUp 0.8s 1.8s both;
    }

    @keyframes fadeInDown {
      from { opacity:0; transform: translateY(-20px); }
      to   { opacity:1; transform: translateY(0); }
    }
    @keyframes fadeInUp {
      from { opacity:0; transform: translateY(20px); }
      to   { opacity:1; transform: translateY(0); }
    }
    @keyframes fadeInSlideUp {
      from { opacity:0; transform: translateY(20px); }
      to   { opacity:1; transform: translateY(0); }
    }

    @media (max-width:400px) {
      h1{ font-size:2.5rem; }
      h2{ font-size:1.5rem; }
      button{ padding:12px; font-size:1rem; }
      #result{ max-width:90%; font-size:1rem; padding:15px; }
    }
  </style>
</head>
<body>
  <video id="bg-video" autoplay muted loop playsinline>
    <source src="assets/bg.mp4" type="video/mp4">
  </video>

  <div class="container">
    <div class="header">
      <h1>Pet Duper</h1>
      <h2>Echo Scripts Key Generator</h2>
    </div>

    <div class="interactive">
      <button id="generate-btn">Generate Key</button>
      <div id="result"></div>
      <button id="copy-btn">Copy Key</button>
    </div>

    <div class="footer">made by: Echo Scripts</div>
  </div>

  <script>
    const btn = document.getElementById('generate-btn');
    const resultEl = document.getElementById('result');
    const copyBtn = document.getElementById('copy-btn');
    const STORAGE = 'petDuperKeyData';
    const EXP_MS = 5*60*60*1000;

    btn.addEventListener('click', genKey);
    copyBtn.addEventListener('click', copyKey);

    function getId() {
      let id = localStorage.getItem('deviceId');
      if (!id) {
        id = crypto.randomUUID();
        localStorage.setItem('deviceId', id);
      }
      return id;
    }
    function load() {
      try { return JSON.parse(localStorage.getItem(STORAGE)); }
      catch { return null; }
    }
    function save(k,e){ localStorage.setItem(STORAGE, JSON.stringify({key:k,expiry:e})); }
    function fmt(s){
      const h=String(Math.floor(s/3600)).padStart(2,'0'),
            m=String(Math.floor((s%3600)/60)).padStart(2,'0'),
            ss=String(s%60).padStart(2,'0');
      return `${h}:${m}:${ss}`;
    }
    function disableGen(){
      btn.disabled=true; btn.textContent='Key Generated';
    }
    function enableGen(){
      btn.disabled=false; btn.textContent='Generate Key';
      copyBtn.style.display='none';
    }
    function tick(exp,key){
      const now=Date.now(), d=Math.floor((exp-now)/1000);
      if(d<=0){
        resultEl.textContent='Key expired. You can now generate a new one.';
        enableGen();
        return;
      }
      resultEl.textContent=`Your Key:\n${key}\n\nExpires in: ${fmt(d)}`;
      requestAnimationFrame(()=>tick(exp,key));
    }
    function showCopy(){
      copyBtn.style.display='block';
    }

    window.onload = ()=>{
      const data=load();
      // animate in
      btn.style.opacity=''; btn.style.transform='';
      resultEl.style.opacity=''; resultEl.style.transform='';
      if(data && data.key && data.expiry){
        if(Date.now()<data.expiry){
          disableGen(); tick(data.expiry,data.key); showCopy();
        } else {
          resultEl.textContent='Key expired. You can now generate a new one.';
        }
      }
    };

    async function genKey(){
      if(btn.disabled) return;
      btn.textContent='Generating...';
      try {
        const res=await fetch(`https://petkeydupe.onrender.com/generate-key?deviceId=${getId()}`);
        const js=await res.json();
        if(js.success && js.key){
          const exp=Date.now()+EXP_MS;
          save(js.key,exp);
          disableGen(); tick(exp,js.key); showCopy();
        } else {
          resultEl.textContent=`Error: ${js.message||'Unable'}`;
          enableGen();
        }
      } catch {
        resultEl.textContent='Network error or backend unreachable';
        enableGen();
      }
    }

    function copyKey(){
      const m=resultEl.textContent.match(/[A-Za-z0-9]{30}/);
      if(m){
        navigator.clipboard.writeText(m[0]).then(()=>{
          copyBtn.textContent='Copied!';
          setTimeout(()=>copyBtn.textContent='Copy Key',1500);
        });
      }
    }
  </script>
</body>
</html>
